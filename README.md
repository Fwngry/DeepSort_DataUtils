## 问题描述

原始文件：seq_(0:5)，一个文件夹对应着一段行人视频，每个文件夹包含(1500:2000)张视频图片帧。

## 标注

使用labelme进行数据标注工作，生成json文件，json文件与png文件一一对应，（除后缀外）文件名相同。json文件包含的有用信息：行人label，行人框的左上(Xleft,Yleft)与右下(Xright,Yright)坐标。一张图片可能会有多个label。

## 重新生成数据集

总体思路：重新生成图片（割取、直方图均衡化）、对文件名进行重新编号、重新生成label、把新文件名和新label的映射关系写入CSV

1. 用于分类训练的数据集，需要依据行人框的坐标，对原图进行分割处理；新生成的每张图片包含一个行人，每个行人对应着一个label，其对应信息写入csv文件；
2. 图像是深度信息，需要进行直方图均衡化处理；
3. 若图像中没有包含行人，则不对该图片进行标注；不包含行人的图片不加入分类训练，也没有相应的json文件。
4. 每个seq文件夹中的label都是从0记起，新生成的数据集需要对label累计

## 操作步骤

```
pwd:path/of/raw/dataset
find seq* /* .json > txt.txt # 基于json，生成原始文件的索引目录，txt格式
```

```
python checkData.py # 遍历全部原始文件夹下的json文件，抽取并检查label
```

label（不重复）生成list：

['0_0', '0_1', '0_2', '0_3', '0_4', '0_5', '0_6', '1_0', '1_1', '1_2', '1_3', '1_4', '1_5', '2_0', '2_1', '2_2', '3_0', '3_1', '3_3', '3_4', '3_5', '3_6', '3_7', '3_8', '3_9', '4_0', '4_1', '4_2', '5_0', '5_1', '5_2']

重新排序，生成字典：

{'0_0': 0, '0_1': 1, '0_2': 2, '0_3': 3, '0_4': 4, '0_5': 5, '0_6': 6, '1_0': 7, '1_1': 8, '1_2': 9, '1_3': 10, '1_4': 11, '1_5': 12, '2_0': 13, '2_1': 14, '2_2': 15, '3_0': 16, '3_1': 17, '3_3': 18, '3_4': 19, '3_5': 20, '3_6': 21, '3_7': 22, '3_8': 23, '3_9': 24, '4_0': 25, '4_1': 26, '4_2': 27, '5_0': 28, '5_1': 29, '5_2': 30}

```
python BuildDataSet.py 
```

逐行读取索引目录.txt，对每个原始文件的json-img进行处理：

1. 读取json和img；
2. 直方图均衡化、根据json中的每个行人框坐标进行图片割取，一个行人框生成一张新的图片，图片文件名重新生成；
3. 依据上一步生成的字典得到新图片的标签；

## 技术

1. 读取文件 img、txt、json

2. Python字符串操作、List、Dict
3. 分割图像
4. 写入CSV